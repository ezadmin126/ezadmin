<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>分类管理</title>

 </head>
 <body id="base-category" datasource="datasource" success_url="reload">
  <div id="append_head" class="append"></div>
  <div class="layui-container">
   <form id="inputForm" method="post" class="layui-form">
    <div class="layui-card" group_name="EZ_DEFAULT_GROUP">
     <div class="layui-card-header">
       EZ_DEFAULT_GROUP 
     </div>
     <div class="layui-card-body">
      <div class="layui-form-item ">
       <label class="layui-form-label">父级分类名称</label>
       <div class="layui-input-block form-group">
        <select class="form-item" name="PARENT_ID" type="span" value="" item_name="PARENT_ID" placeholder="" style="" alias="" jdbctype="" data="SELECT
        M.CATEGORY_ID K,

        CATEGORY_NAME V
    FROM
        T_BASE_CATEGORY M
    WHERE
        DELETE_FLAG = 0 AND COMPANY_ID=${COMPANY_ID}" datatype="KVSQL" lay_verify="" item_desc="" group_data="" valid_rule="" valid_msg="" item_max_upload=""> </select> 
       </div>
      </div>
      <div class="layui-form-item ">
       <label class="layui-form-label">分类名称</label>
       <div class="layui-input-block form-group">
        <input class="form-item" name="CATEGORY_NAME" type="text" value="" item_name="CATEGORY_NAME" placeholder="" style="" alias="" jdbctype="" data="" datatype="" lay_verify="" item_desc="" group_data="" valid_rule="" valid_msg="" item_max_upload="">
       </div>
      </div>
      <div class="layui-form-item ">
       <label class="layui-form-label">分类编码</label>
       <div class="layui-input-block form-group">
        <input class="form-item" name="CATEGORY_CODE" type="text" value="" item_name="CATEGORY_CODE" placeholder="" style="" alias="" jdbctype="" data="" datatype="" lay_verify="" item_desc="" group_data="" valid_rule="" valid_msg="" item_max_upload="">
       </div>
      </div>
     </div>
    </div>
   </form>
   <form id="configForm" class="layui-form">
    <div class="layui-card" group_name="表单数据配置">
     <div class="layui-card-header">
       表单数据配置 
     </div>
     <div class="layui-card-body">
     </div>
    </div>
    <div class="layui-form-item ">
     <label class="layui-form-label">初始表达式</label>
     <div class="layui-input-block form-group">
      <pre class="form-item layui-code" id="init" name="init_express"  item_name="init_express" type="">StringBuilder sql=new StringBuilder();
companyId=$$("COMPANY_ID");
sql.append("select CATEGORY_ID ID, CATEGORY_ID,PARENT_ID,CATEGORY_NAME,CATEGORY_CODE from T_BASE_CATEGORY where  CATEGORY_ID=${ID}  ");
if(companyId&gt;1){
	sql.append(" AND COMPANY_ID="+companyId);
}
return select(sql).get(0);</pre>
     </div>
    </div>
    <div class="layui-form-item "><label class="layui-form-label">提交表达式</label>
     <div class="layui-input-block form-group">
      <pre class="form-item layui-code" id="submit" name="submit_express"  item_name="submit_express" type="">import top.ezadmin.plugins.express.jdbc.UpdateParam;
import top.ezadmin.plugins.express.jdbc.InsertParam;
companyId=$$("COMPANY_ID");                 		
sessionUserId=$$("EZ_SESSION_USER_ID_KEY");        
sessionUserName=$$("EZ_SESSION_USER_NAME_KEY");    
if(!isNotBlank("ID")){                  		
    param=new InsertParam();                		
    param.table("T_BASE_CATEGORY");
    param.add("#{PARENT_ID,jdbcType=NUMBER}");
    param.add("#{CATEGORY_NAME}");
    param.add("#{CATEGORY_CODE}");
    param.add("#{COMPANY_ID,value="+companyId+"}");
    param.add("#{ADD_TIME,value=NOW()}"); 
    param.add("#{ADD_ID,value='"+sessionUserId+"'}"); 
    param.add("#{ADD_NAME,value='"+sessionUserName+"'}"); 
id=insertSimple(param);
return id; 
}else{                 								
    param=new UpdateParam();
    param.table("T_BASE_CATEGORY");               		
     param.add("#{PARENT_ID,jdbcType=NUMBER}");
    param.add("#{CATEGORY_NAME}");               		
    param.add("#{CATEGORY_CODE}");
   param.add("#{UPDATE_TIME,value=NOW()}");
   param.add("#{UPDATE_ID,value='"+sessionUserId+"'}");
   param.add("#{UPDATE_NAME,value='"+sessionUserName+"'}");
  StringBuilder updateSql=new StringBuilder();
  updateSql.append(" where CATEGORY_ID=#{ID} ");
  if(companyId&gt;1){
      updateSql.append(" and COMPANY_ID= "+companyId);
  }
 param.where(updateSql.toString());
 updateSimple(param);
 return ID;
}</pre>
     </div>
    </div>
    <div class="layui-form-item "><label class="layui-form-label">删除表达式</label>
     <div class="layui-input-block form-group">
      <pre class="form-item layui-code" id="delete" name="delete_express"  item_name="delete_express" type="">update("update  T_BASE_CATEGORY set delete_flag=1 where CATEGORY_ID=${ID}");</pre>
     </div>
    </div>
    <div class="layui-form-item ">
     <label class="layui-form-label">分组表达式</label>
     <div class="layui-input-block form-group">
      <pre class="form-item layui-code" name="group_data"  item_name="group_data" type=""></pre>
     </div>
    </div>
   </form>
  </div>

  <script>
    layui.use(function () {

    })
</script>
  <div id="append_foot" class="append">
  </div>
 </body>
</html>